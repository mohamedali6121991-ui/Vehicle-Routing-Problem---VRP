<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø­Ù…ÙˆÙ„Ø§Øª</title>
    <style>
        body { font-family: Tahoma, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        input[type="file"] { display: block; margin: 15px 0; padding: 10px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        #results { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
        .vehicle-route { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 4px; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø³ÙŠØ± (VRP)</h1>
        
        <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù CSV ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø·Ù„Ø¨ (ÙŠÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø­Ø§Ù„ÙŠ):</p>
        
        <input type="file" id="csvFile" accept=".csv">
        <button onclick="processAndSendFile()">ØªØ­Ù„ÙŠÙ„ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</button>
        
        <div id="results">
            <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ø³ÙŠÙ†:</h2>
            <div id="routeOutput"></div>
        </div>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù CSV
        function readCSV(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const text = e.target.result;
                    const lines = text.trim().split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    const data = [];
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',').map(v => v.trim());
                        if (values.length === headers.length) {
                            const entry = {};
                            headers.forEach((header, index) => {
                                entry[header] = values[index];
                            });
                            data.push(entry);
                        }
                    }
                    resolve(data);
                };
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        async function processAndSendFile() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            if (!file) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…Ù„Ù CSV Ø£ÙˆÙ„Ø§Ù‹.");
                return;
            }

            try {
                // 1. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ JSON
                const customerData = await readCSV(file);
                
                // 2. ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ÙŠØªÙ… ØªØ®Ø²ÙŠÙ†Ù‡Ø§ Ù‡Ù†Ø§)
                const payload = {
                    customer_data: customerData,
                    // Ø³Ù†ÙØªØ±Ø¶ Ø£Ù† Ø³Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø«Ø§Ø¨ØªØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    vehicle_capacities: [15, 15], // Ø³Ø¹Ø© ÙƒÙ„ Ø³ÙŠØ§Ø±Ø© 15 ÙˆØ­Ø¯Ø© Ø­Ù…ÙˆÙ„Ø©
                    depot_index: 0 // Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù‡Ùˆ Ø£ÙˆÙ„ Ù†Ù‚Ø·Ø© (Ø§Ù„Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 0)
                };

                // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ (Flask)
                const response = await fetch('http://127.0.0.1:5000/solve_vrp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                // 4. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                displayResults(result);

            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£:', error);
                document.getElementById('routeOutput').innerHTML = `<p style="color: red;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${error.message}</p>`;
            }
        }

        function displayResults(data) {
            const outputDiv = document.getElementById('routeOutput');
            outputDiv.innerHTML = '';

            if (data.solution_status === "OPTIMAL") {
                data.routes.forEach((route, index) => {
                    const routeText = route.route_nodes.join(' $\\rightarrow$ ');
                    const routeElement = document.createElement('div');
                    routeElement.className = 'vehicle-route';
                    routeElement.innerHTML = `
                        <h3>ğŸšš Ù…Ø³Ø§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø±Ù‚Ù… ${index + 1}</h3>
                        <p><strong>Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„ÙƒÙ„ÙŠØ©:</strong> ${route.total_load} ÙˆØ­Ø¯Ø§Øª</p>
                        <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ©:</strong> ${route.total_distance.toFixed(2)} ÙƒÙ… (Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)</p>
                        <p><strong>ØªØ³Ù„Ø³Ù„ Ø§Ù„ØªÙˆÙ‚ÙØ§Øª:</strong> Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ${routeText} $\\rightarrow$ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</p>
                    `;
                    outputDiv.appendChild(routeElement);
                });
            } else {
                outputDiv.innerHTML = `<p style="color: orange;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù„ Ø£Ù…Ø«Ù„. Ø§Ù„Ø­Ø§Ù„Ø©: ${data.solution_status}</p>`;
            }
        }
    </script>
</body>
</html>
pip install Flask ortools
from flask import Flask, request, jsonify
from ortools.constraint_solver import routing_enums_pb2
from ortools.constraint_solver import pywrapcp
from flask_cors import CORS # Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ©

# --- 1. Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ·Ø¨ÙŠÙ‚ Flask ---
app = Flask(__name__)
# Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù…Ù„Ù HTML Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø®Ø§Ø¯Ù… (Ù…Ù‡Ù… Ù„Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø­Ù„ÙŠ)
CORS(app) 

# --- 2. Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„Ù…Ø´ÙƒÙ„Ø© (ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ù‹Ø§) ---
# Ù†ÙØªØ±Ø¶ Ø£Ù† Ù„Ø¯ÙŠÙ†Ø§ 6 Ù†Ù‚Ø§Ø· (Ø§Ù„Ù†Ù‚Ø·Ø© 0 Ù‡ÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ØŒ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù…Ù„Ø§Ø¡)
# Ù…ØµÙÙˆÙØ© Ù…Ø³Ø§ÙØ§Øª ÙˆÙ‡Ù…ÙŠØ© (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† A Ø¥Ù„Ù‰ B Ù‡ÙŠ Ù†ÙØ³Ù‡Ø§ Ù…Ù† B Ø¥Ù„Ù‰ A)
# Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ÙƒØ§Ù„Ù†Ù‚Ø·Ø© 0)
def create_distance_matrix(num_locations):
    # Ù…ØµÙÙˆÙØ© Ù…Ø³Ø§ÙØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø¨ÙƒÙ…/Ø¨Ø§Ù„Ù…ØªØ±)
    # 0 = Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹, 1..5 = Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
    return [
        [0, 10, 15, 20, 12, 8],   # Ù…Ù† 0 (Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹)
        [10, 0, 8, 11, 14, 2],    # Ù…Ù† 1 (Ø¹Ù…ÙŠÙ„ 1)
        [15, 8, 0, 5, 6, 1],      # Ù…Ù† 2 (Ø¹Ù…ÙŠÙ„ 2)
        [20, 11, 5, 0, 7, 13],    # Ù…Ù† 3 (Ø¹Ù…ÙŠÙ„ 3)
        [12, 14, 6, 7, 0, 9],     # Ù…Ù† 4 (Ø¹Ù…ÙŠÙ„ 4)
        [8, 2, 1, 13, 9, 0]       # Ù…Ù† 5 (Ø¹Ù…ÙŠÙ„ 5)
    ]

# --- 3. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
def solve_vrp(data):
    """Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ù…Ø¹ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø³Ø¹Ø© (CVRP)."""
    
    # 3.1. ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª OR-Tools
    # Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø¯ (Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹)
    manager = pywrapcp.RoutingIndexManager(
        data['num_locations'], data['num_vehicles'], data['depot_index'])
    
    # Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
    routing = pywrapcp.RoutingModel(manager)

    # 3.2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙƒÙ„ÙØ© (Transit Callback)
    # ØªØ­Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø§ÙØ©/Ø§Ù„ØªÙƒÙ„ÙØ© Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø£ÙŠ Ù†Ù‚Ø·ØªÙŠÙ†
    def distance_callback(from_index, to_index):
        """Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ†."""
        from_node = manager.IndexToNode(from_index)
        to_node = manager.IndexToNode(to_index)
        return data['distance_matrix'][from_node][to_node]

    transit_callback_index = routing.RegisterTransitCallback(distance_callback)
    routing.SetArcCostEvaluatorOfAllVehicles(transit_callback_index)

    # 3.3. Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø³Ø¹Ø© (Capacity Constraint)
    # ØªØ­Ø¯Ø¯ Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨/Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø¬Ù…Ø¹Ù‡Ø§ ÙÙŠ ÙƒÙ„ Ù†Ù‚Ø·Ø©
    def demand_callback(from_index):
        """Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ù„Ø­Ù…ÙˆÙ„Ø©) ÙÙŠ ÙƒÙ„ Ù†Ù‚Ø·Ø©."""
        from_node = manager.IndexToNode(from_index)
        return data['demands'][from_node]

    demand_callback_index = routing.RegisterUnaryTransitCallback(demand_callback)

    # Ø¥Ø¶Ø§ÙØ© Ø¨ÙØ¹Ø¯ "Ø§Ù„Ø­Ù…ÙˆÙ„Ø©" Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
    routing.AddDimensionWithVehicleCapacity(
        demand_callback_index,  # Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨/Ø§Ù„Ø­Ù…ÙˆÙ„Ø©
        0,                      # Ø³Ø¹Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Accumulation slack) Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§
        data['vehicle_capacities'],  # Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø³Ø¹Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
        True,                   # Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ±
        'Capacity')

    # 3.4. ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« (Search Parameters)
    search_parameters = pywrapcp.DefaultRoutingSearchParameters()
    search_parameters.first_solution_strategy = (
        routing_enums_pb2.FirstSolutionStrategy.PATH_CHEAPEST_ARC) # Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    
    # ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    search_parameters.local_search_metaheuristic = (
        routing_enums_pb2.LocalSearchMetaheuristic.GUIDED_LOCAL_SEARCH)
    search_parameters.time_limit.seconds = 1  # ØªØ­Ø¯ÙŠØ¯ Ø²Ù…Ù† Ø§Ù„Ø¨Ø­Ø« (Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ)

    # 3.5. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ù„
    solution = routing.SolveWithParameters(search_parameters)

    return routing, manager, solution

# --- 4. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Processing the Solution) ---
def get_solution_details(data, manager, routing, solution):
    """ØªØ­ÙˆÙŠÙ„ ÙƒØ§Ø¦Ù† Ø§Ù„Ø­Ù„ Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ JSON Ø³Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©."""
    if not solution:
        return {'solution_status': 'NO_SOLUTION', 'routes': []}

    routes = []
    
    # Ø¬Ù„Ø¨ Ø¨ÙØ¹Ø¯ Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ù„ÙƒÙ„ Ø³ÙŠØ§Ø±Ø©
    capacity_dimension = routing.GetDimensionOrDie('Capacity')
    
    # ØªÙƒØ±Ø§Ø± Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ø±ÙƒØ¨Ø©
    for vehicle_id in range(data['num_vehicles']):
        index = routing.Start(vehicle_id) # Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹)
        route_nodes = []
        route_distance = 0
        total_load = 0

        # ØªÙƒØ±Ø§Ø± Ø¹Ù„Ù‰ Ø·ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø±
        while not routing.IsEnd(index):
            node_index = manager.IndexToNode(index)
            
            # Ø¬Ù„Ø¨ Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ø¹Ù†Ø¯ Ù‡Ø°Ø§ Ø§Ù„ØªÙˆÙ‚Ù (Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­Ù…ÙˆÙ„Ø©)
            load_var = capacity_dimension.CumulVar(index)
            
            # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø·Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± (ØªØ¬Ù†Ø¨ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰)
            if node_index != data['depot_index']:
                 route_nodes.append(node_index)

            previous_index = index
            index = solution.Value(routing.NextVar(index))
            
            # Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©
            route_distance += routing.Get ;ArcCostForVehicle(previous_index, index, vehicle_id)
            
        # Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø±ØŒ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ø³ÙŠØ§Ø±Ø© (Ø£Ù‚ØµÙ‰ Ø­Ù…ÙˆÙ„Ø© ØªÙ… Ø­Ù…Ù„Ù‡Ø§)
        end_index = routing.End(vehicle_id)
        total_load = solution.Value(capacity_dimension.CumulVar(end_index))
        
        # Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ù„Ù†ØªØ§Ø¦Ø¬ JSON
        routes.append({
            'vehicle_id': vehicle_id + 1,
            'route_nodes': route_nodes,
            'total_distance': route_distance / 1000, # ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ ÙƒÙ… (Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§)
            'total_load': total_load
        })

    return {
        'solution_status': 'OPTIMAL',
        'objective_value': solution.ObjectiveValue(), # Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©)
        'routes': routes
    }


# --- 5. Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© (API Endpoint) Ù„Ù€ Flask ---
@app.route('/solve_vrp', methods=['POST'])
def handle_vrp_request():
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© VRP."""
    try:
        # 1. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
        request_data = request.get_json()
        
        customer_data = request_data.get('customer_data', [])
        vehicle_capacities = request_data.get('vehicle_capacities', [])
        depot_index = request_data.get('depot_index', 0)

        # 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù€ OR-Tools
        # Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ 1 (Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹) + Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        num_customers = len(customer_data)
        num_locations = num_customers + 1
        num_vehicles = len(vehicle_capacities)
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
        distance_matrix = create_distance_matrix(num_locations) 
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø¨ (Demand Matrix)
        # Ø§Ù„Ù†Ù‚Ø·Ø© 0 (Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹) Ù„Ù‡Ø§ Ø·Ù„Ø¨ 0
        demands = [0] + [int(c['Demand']) for c in customer_data]
        
        # ØªØ¬Ù…ÙŠØ¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ù…ÙˆØ³ ÙˆØ§Ø­Ø¯
        data = {
            'distance_matrix': distance_matrix,
            'demands': demands,
            'num_locations': num_locations,
            'num_vehicles': num_vehicles,
            'depot_index': depot_index,
            'vehicle_capacities': vehicle_capacities
        }

        # 3. Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
        routing, manager, solution = solve_vrp(data)

        # 4. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
        response = get_solution_details(data, manager, routing, solution)
        return jsonify(response)

    except Exception as e:
        print(f"Error during VRP solving: {e}")
        return jsonify({'error': str(e), 'solution_status': 'ERROR'}), 500

# --- 6. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… ---
if __name__ == '__main__':
    # ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ´ØºÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° ÙˆØ§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ØªØ³ØªØ®Ø¯Ù…Ù‡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
    app.run(debug=True)
